const express = require("express");
const midtransClient = require("midtrans-client");
const cors = require("cors");

const app = express();
app.use(express.json());
app.use(cors());

// Konfigurasi Midtrans
const snap = new midtransClient.Snap({
  isProduction: false,
  serverKey: "YOUR_SERVER_KEY",
  clientKey: "YOUR_CLIENT_KEY"
});

app.post("/create-transaction", async (req, res) => {
  const { userId, game, nominal } = req.body;

  const parameter = {
    transaction_details: {
      order_id: "order-" + Date.now(),
      gross_amount: parseInt(nominal)
    },
    customer_details: {
      first_name: game,
      last_name: "Topup",
      email: "customer@example.com",
      phone: userId
    }
  };

  try {
    const transaction = await snap.createTransaction(parameter);
    res.json({ token: transaction.token });
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: "Gagal membuat transaksi" });
  }
});

app.listen(5000, () => console.log("Server jalan di http://localhost:5000"));
